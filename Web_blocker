import tkinter as tk
from tkinter import messagebox, simpledialog
import os
import sys
import ctypes

class WebBlocker:
    def __init__(self, root):
        self.root = root
        self.root.title("Web Blocker")
        self.root.geometry("400x400")

        self.hosts_path = r"C:\Windows\System32\drivers\etc\hosts"
        self.redirect_ip = "127.0.0.1"
        self.blocked_websites = self.load_blocked_websites()

        #GUI Elements
        self.label = tk.label(root, text="Enter website to block (e.g. www.example.com):")
        self.label.pack(pady=10)

        self.entry = tk.Entry(root, width=50)
        self.entry.pack(pady=5)
 
 
        self.add_button = tk.Button(root, text="Add to Block List", command=self.add_site)
        self.add_button.pack(pady=5)

        self.listbox = tk.Listbox(root, width=50, height=10)
        self.listbox.pack(pady=10)
        self.update_listbox()

        self.block_button = tk.Button(root, text="Block Selected Sites", command=self.block_websites)
        self.block_button.pack(side=tk.LEFT, padx=10)

        self.unblock_button = tk.Button(root, text="Unblock Selected Sites", command=self.unblock_websites)
        self.unblock_button.pack(side=tk.RIGHT, padx=10)

        self.unblock_all_button = tk.Button(root, text="Unblock All", command=self.unblock_all)
        self.unblock_all_button.pack(pady=10)

def load_blocked_websites(self):
    blocked =[]
    try:
        with open(self.hosts_path, 'r') as file:
            for line in file:
                if line.strip().startswith(self.redirect_ip):
                    parts = line.strip().split()
                    if len(parts) >= 2:
                        blocked.append(parts[1])
    except FileNotFoundError:
        messagebox.showerror("Error", "Hosts file not found. Run as administrator.")
    except PermissionError:
        messagebox.showerror("Error", "Permission denied. Run as administrator.")
    return blocked

def save_hosts(self, lines):
    try:
        with open(self.hosts_paths, 'w') as file:
            file.writelines(lines)
        messagebox.showinfo("Success", "Hosts file updated successfully.")
    except PermissionError:
        messagebox.showerror("Error", "Permission denied. Run as administrator.")

def add_site(self):
    site = self.entry.get().strip()
    if not site:
        messagebox.showwarning("Warning", "Enter a validwebsite.")
        return
    
    #Clean the site: remove protocol
    if site.startswith("http://"):
        site = site[7:]
    elif site.startswith("https://"):
        site = site[8:]
    


       

        



















